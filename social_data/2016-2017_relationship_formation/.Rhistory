distance = mean(dist, na.rm=T))
mean(c(NA, NA))
mean(c(NA, NA), na.rm=T)
View(d)
d %>%
mutate(dyad = ifelse(bat1<bat2, paste(bat1,bat2, sep= "_"), paste(bat2,bat1, sep= "_"))) %>%
arrange(dyad) %>%
group_by(dyad)
sum(c(2, NA), na.rm=T)/2
sum(c(0, NA), na.rm=T)/2
sum(c(NA, NA), na.rm=T)/2
mean(c(1, NA), na.rm=T)
mean(c(NA, NA), na.rm=T)
# try with only postdoc data
# model dist as predicted by food sharing ------
fs <-
d3 %>%
filter(!is.na(dist)) %>%
filter(!is.na(sharing)) %>%
filter(season1=="phd" & season2== "phd") #??????
View(d2)
View(d3)
# try with only postdoc data
# model dist as predicted by food sharing ------
fs <-
d3 %>%
filter(!is.na(distance)) %>%
filter(!is.na(sharing)) %>%
filter(season1=="phd" & season2== "phd") #??????
View(fs)
rm(list=ls())
# load packages
library(tidyverse)
# set working directory
setwd("/Users/jkvrtilek/Desktop/OSU/PhD/GitHub/call-convergence/social_data/2010-2014_foodsharing")
# get data
# food sharing events
d <- read.csv("vamp_donations19.csv")
# possible donors for each trial
pos.d <- read.csv("vamp_possible donors3.csv")
# kinship estimates using two methods (with and without pedigree info)
kinship <- read.csv("vamp_relatedness12.csv")
View(d)
View(kinship)
View(pos.d)
# bat sexes and ages
bats <- read.csv("vamp_sex_age.csv")
# check all receivers and donors are in bats dataframe (df)
unique(d$receiver)[which(!unique(d$receiver) %in% bats$name)]
unique(d$donor)[which(!unique(d$donor) %in% bats$name)]
# fix bat names
d$donor[which(d$donor== "leord")] <- "leonard"
d$donor[which(d$donor== "")] <- NA
# check which bats are not in donation data
tbats <- unique(c(d$receiver, d$donor))
bats$name[which(!bats$name %in% tbats)]
# get names in possible donors that don't match bat names
pd <- unique(as.vector(as.matrix(pos.d)))
pd[which(!pd %in% bats$name)]
View(pos.d)
# change these names in possible donors matrix
pos.d <- gsub("two", "bat2", pos.d)
# possible donors for each trial
pos.d <- read.csv("vamp_possible donors3.csv")
# change these names in possible donors matrix
pos.d2 <- pos.d %>%
mutate(across(everything(), ~ str_replace(string = .x, pattern = "two", replacement = "bat2"))) %>%
mutate(across(everything(), ~ str_replace(string = .x, pattern = "three", replacement = "bat3"))) %>%
mutate(across(everything(), ~ str_replace(string = .x, pattern = "four", replacement = "bat4")))
View(pos.d2)
View(pos.d)
# get names in possible donors that don't match bat names
pd <- unique(as.vector(as.matrix(pos.d)))
pd[which(!pd %in% bats$name)]
View(pos.d)
View(pos.d2)
bats$name[which(!bats$name %in% pd)]
# to get actual and possible donations...
# first get all combinations of bats for every trial
t <-
expand_grid(trial= d$trial, donor= bats$name, receiver= bats$name, duration= 0) %>%
filter(donor!=receiver)
View(t)
# then delete impossible cases of food sharing
for (i in 1:length(pos.d2)) {
# get current trial
focal.trial <- i
# get possible donors for current trial (bats present during trial)
pos <- pos.d2[,focal.trial]
# get the possible receiver (fasted bat) for current trial
pos2 <-
d %>%
filter(trial== focal.trial) %>%
pull(receiver) %>%
unique()
# put NA duration for trials where donor is not a possible donor or receiver is not possible receiver
t$duration[which(t$trial == focal.trial & !(t$donor %in% pos))] <- NA
t$duration[which(t$trial == focal.trial & !(t$receiver %in% pos2))] <- NA
# show progress
print(paste(i,"of",length(pos.d2)))
}
View(t)
# label observed cases of food sharing
d$trial.donor.receiver <- paste0(d$trial, d$donor, d$receiver)
View(d)
# get actual and possible donations
d2 <-
t %>%
# discard impossible donations
filter(duration==0) %>%
# add observed cases of food sharing
mutate(trial.donor.receiver= paste0(trial,donor,receiver)) %>%
mutate(donation.sec = d$duration[match(.$trial.donor.receiver, d$trial.donor.receiver)]) %>%
mutate(donation.sec= ifelse(is.na(donation.sec), 0, donation.sec)) %>%
# add trial duration (observation time) in seconds
mutate(observation.sec = 60*60*d$trial.duration..h.[match(.$trial, d$trial)]) %>%
# add trial dates
mutate(date = d$date[match(.$trial, d$trial)]) %>%
select(date, trial, donor, receiver, donation.sec, observation.sec)
View(d2)
# save food-sharing trial data
write.csv(d2, "food_sharing_donations_2010-2014.csv")
# label kinship dyads
kinship$dyad <- paste(kinship$bat1, kinship$bat2)
View(kinship)
# now get dyadic rates with sex, kinship
d3 <-
d2 %>%
group_by(donor, receiver) %>%
summarize(donation.sec= sum(donation.sec), possible.sec= sum(observation.sec), .groups= 'drop') %>%
# label dyad
mutate(dyad= paste(donor,receiver)) %>%
# add kinship
mutate(kinship= kinship$pedigree.m19[match(.$dyad, kinship$dyad)]) %>%
# add donor sex
mutate(donor.sex= bats$sex[match(.$donor, bats$name)]) %>%
# add receiver sex
mutate(receiver.sex= bats$sex[match(.$receiver, bats$name)]) %>%
# add donor age
mutate(donor.age.2014.10.07= bats$age20141007[match(.$donor, bats$name)]) %>%
# add receiver age
mutate(receiver.age.2014.10.07= bats$age20141007[match(.$receiver, bats$name)]) %>%
# donation rate
mutate(donation.rate= donation.sec/possible.sec) %>%
select(-dyad)
View(d3)
View(kinship)
View(bats)
# save food-sharing rates data
write.csv(d3, "food_sharing_rates_2010-2014.csv")
View(d3)
read.csv("/Users/jkvrtilek/Desktop/social_data_old/2015_foodsharing_rates.csv")
# set working directory
setwd("/Users/jkvrtilek/Desktop/OSU/PhD/GitHub/call-convergence/social_data/2016-2017_relationship_formation")
# get data
load("new_bonds_data.RData")
# compile all vampire bat food sharing data from Gerry Carter's PhD
# download PhD data from here:
# Carter, Gerald; Schino, Gabriele; Farine, Damien (2018). Data and R code for "Challenges in assessing the roles of nepotism and reciprocity in cooperation networks". figshare. Dataset. https://doi.org/10.6084/m9.figshare.6072272.v6
# edited by Julia, 8 May 2024
rm(list=ls())
# load packages
library(tidyverse)
# set working directory
setwd("/Users/jkvrtilek/Desktop/OSU/PhD/GitHub/call-convergence/social_data/2010-2014_foodsharing")
# get data
# food sharing events
d <- read.csv("vamp_donations19.csv")
# possible donors for each trial
pos.d <- read.csv("vamp_possible donors3.csv")
# kinship estimates using two methods (with and without pedigree info)
kinship <- read.csv("vamp_relatedness12.csv")
# bat sexes and ages
bats <- read.csv("vamp_sex_age.csv")
# check all receivers and donors are in bats dataframe (df)
unique(d$receiver)[which(!unique(d$receiver) %in% bats$name)]
unique(d$donor)[which(!unique(d$donor) %in% bats$name)]
# fix bat names
d$donor[which(d$donor== "leord")] <- "leonard"
d$donor[which(d$donor== "")] <- NA
# check which bats are not in donation data
tbats <- unique(c(d$receiver, d$donor))
bats$name[which(!bats$name %in% tbats)]
# correct: these are all bats that just never donated
# get names in possible donors that don't match bat names
pd <- unique(as.vector(as.matrix(pos.d)))
pd[which(!pd %in% bats$name)]
# change these names in possible donors matrix
pos.d2 <- pos.d %>%
mutate(across(everything(), ~ str_replace(string = .x, pattern = "two", replacement = "bat2"))) %>%
mutate(across(everything(), ~ str_replace(string = .x, pattern = "three", replacement = "bat3"))) %>%
mutate(across(everything(), ~ str_replace(string = .x, pattern = "four", replacement = "bat4")))
bats$name[which(!bats$name %in% pd)]
# correct: these are all bats that were never tested as donors
# to get actual and possible donations...
# first get all combinations of bats for every trial
t <-
expand_grid(trial= d$trial, donor= bats$name, receiver= bats$name, duration= 0) %>%
filter(donor!=receiver)
# then delete impossible cases of food sharing
for (i in 1:length(pos.d2)) {
# get current trial
focal.trial <- i
# get possible donors for current trial (bats present during trial)
pos <- pos.d2[,focal.trial]
# get the possible receiver (fasted bat) for current trial
pos2 <-
d %>%
filter(trial== focal.trial) %>%
pull(receiver) %>%
unique()
# put NA duration for trials where donor is not a possible donor or receiver is not possible receiver
t$duration[which(t$trial == focal.trial & !(t$donor %in% pos))] <- NA
t$duration[which(t$trial == focal.trial & !(t$receiver %in% pos2))] <- NA
# show progress
print(paste(i,"of",length(pos.d2)))
}
# label observed cases of food sharing
d$trial.donor.receiver <- paste0(d$trial, d$donor, d$receiver)
# get actual and possible donations
d2 <-
t %>%
# discard impossible donations
filter(duration==0) %>%
# add observed cases of food sharing
mutate(trial.donor.receiver= paste0(trial,donor,receiver)) %>%
mutate(donation.sec = d$duration[match(.$trial.donor.receiver, d$trial.donor.receiver)]) %>%
mutate(donation.sec= ifelse(is.na(donation.sec), 0, donation.sec)) %>%
# add trial duration (observation time) in seconds
mutate(observation.sec = 60*60*d$trial.duration..h.[match(.$trial, d$trial)]) %>%
# add trial dates
mutate(date = d$date[match(.$trial, d$trial)]) %>%
select(date, trial, donor, receiver, donation.sec, observation.sec)
# label kinship dyads
kinship$dyad <- paste(kinship$bat1, kinship$bat2)
# now get dyadic rates with sex, kinship
d3 <-
d2 %>%
group_by(donor, receiver) %>%
summarize(donation.sec= sum(donation.sec), possible.sec= sum(observation.sec), .groups= 'drop') %>%
# label dyad
mutate(dyad= paste(donor,receiver)) %>%
# add kinship
mutate(kinship= kinship$pedigree.m19[match(.$dyad, kinship$dyad)]) %>%
# add donor sex
mutate(donor.sex= bats$sex[match(.$donor, bats$name)]) %>%
# add receiver sex
mutate(receiver.sex= bats$sex[match(.$receiver, bats$name)]) %>%
# add donor age
mutate(donor.age.2014.10.07= bats$age20141007[match(.$donor, bats$name)]) %>%
# add receiver age
mutate(receiver.age.2014.10.07= bats$age20141007[match(.$receiver, bats$name)]) %>%
# donation rate
mutate(donation.rate= donation.sec/possible.sec) %>%
select(-dyad)
View(d3)
library(tidyverse)
Gerry <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/GitHub/call-convergence/social_data/2010-2014_foodsharing/food_sharing_rates_2010-2014.csv") %>%
mutate(rate = donation.rate)
Gerry$donor <- gsub("four","bat4",Gerry$donor)
Gerry$receiver <- gsub("four","bat4",Gerry$receiver)
Gerry$donor <- gsub("two","bat2",Gerry$donor)
Gerry$receiver <- gsub("two","bat2",Gerry$receiver)
Gerry$donor <- gsub("three","bat3",Gerry$donor)
Gerry$receiver <- gsub("three","bat3",Gerry$receiver)
Gerry2 <- Gerry %>%
mutate(dir.dyad = paste(donor, receiver, sep = "_")) %>%
select(dir.dyad, rate)
Julia <- read.csv("/Users/jkvrtilek/Desktop/social_data_old/2015_foodsharing_rates.csv")
Julia$donor <- gsub("four","bat4",Julia$donor)
Julia$donor <- gsub("two","bat2",Julia$donor)
Julia$donor <- gsub("three","bat3",Julia$donor)
Julia$donor <- gsub("leord","leonard",Julia$donor)
Julia2 <- Julia %>%
mutate(dir.dyad = paste(donor, receiver, sep = "_")) %>%
select(dir.dyad, rate)
x <- left_join(Julia2, Gerry2, by = "dir.dyad")
View(x)
View(x)
# compile all vampire bat food sharing data from Gerry Carter's postdoc
# download PhD data from here:
# Carter, Gerald (2019). Data and R Code for Carter et al. 2020. Development of new food-sharing relationships in vampire bats. Current Biology.. figshare. Dataset. https://doi.org/10.6084/m9.figshare.11369268.v1
# edited by Julia, 8 May 2024
# clear workspace
rm(list=ls())
# load packages
library(tidyverse)
# set working directory
setwd("/Users/jkvrtilek/Desktop/OSU/PhD/GitHub/call-convergence/social_data/2016-2017_relationship_formation")
# get data
load("new_bonds_data.RData")
unique(rates$date)
unique(rates$days.together)
# get relevant data
d <-
rates %>%
as_tibble() %>%
# exclude controlled introductions?
#  filter(cage.type=="colony") %>%
filter(behav== "f"| behav== "g") %>%
filter(!nonfocal) %>%
# clarify column meanings
select(datetime, period, trial, trial.duration, subject, actor, receiver, behav, duration.sec= rate, actor.origin= a.pop, receiver.origin= r.pop, actor.is.mom, receiver.is.mom, new.dyad, both.adult= adult.dyad, intro.date, days.together, actor.birthdate= a.birth, receiver.birthdate= r.birth, kinship= kinship2)
# compile all vampire bat food sharing data from Gerry Carter's PhD
# download PhD data from here:
# Carter, Gerald; Schino, Gabriele; Farine, Damien (2018). Data and R code for "Challenges in assessing the roles of nepotism and reciprocity in cooperation networks". figshare. Dataset. https://doi.org/10.6084/m9.figshare.6072272.v6
# edited by Julia, 8 May 2024
rm(list=ls())
# load packages
library(tidyverse)
# set working directory
setwd("/Users/jkvrtilek/Desktop/OSU/PhD/GitHub/call-convergence/social_data/2010-2014_foodsharing")
# get data
# food sharing events
d <- read.csv("vamp_donations19.csv")
# possible donors for each trial
pos.d <- read.csv("vamp_possible donors3.csv")
# kinship estimates using two methods (with and without pedigree info)
kinship <- read.csv("vamp_relatedness12.csv")
# bat sexes and ages
bats <- read.csv("vamp_sex_age.csv")
# check all receivers and donors are in bats dataframe (df)
unique(d$receiver)[which(!unique(d$receiver) %in% bats$name)]
unique(d$donor)[which(!unique(d$donor) %in% bats$name)]
# fix bat names
d$donor[which(d$donor== "leord")] <- "leonard"
d$donor[which(d$donor== "")] <- NA
# check which bats are not in donation data
tbats <- unique(c(d$receiver, d$donor))
bats$name[which(!bats$name %in% tbats)]
# correct: these are all bats that just never donated
# get names in possible donors that don't match bat names
pd <- unique(as.vector(as.matrix(pos.d)))
pd[which(!pd %in% bats$name)]
# change these names in possible donors matrix
pos.d2 <- pos.d %>%
mutate(across(everything(), ~ str_replace(string = .x, pattern = "two", replacement = "bat2"))) %>%
mutate(across(everything(), ~ str_replace(string = .x, pattern = "three", replacement = "bat3"))) %>%
mutate(across(everything(), ~ str_replace(string = .x, pattern = "four", replacement = "bat4")))
bats$name[which(!bats$name %in% pd)]
# correct: these are all bats that were never tested as donors
# to get actual and possible donations...
# first get all combinations of bats for every trial
t <-
expand_grid(trial= d$trial, donor= bats$name, receiver= bats$name, duration= 0) %>%
filter(donor!=receiver)
# then delete impossible cases of food sharing
for (i in 1:length(pos.d2)) {
# get current trial
focal.trial <- i
# get possible donors for current trial (bats present during trial)
pos <- pos.d2[,focal.trial]
# get the possible receiver (fasted bat) for current trial
pos2 <-
d %>%
filter(trial== focal.trial) %>%
pull(receiver) %>%
unique()
# put NA duration for trials where donor is not a possible donor or receiver is not possible receiver
t$duration[which(t$trial == focal.trial & !(t$donor %in% pos))] <- NA
t$duration[which(t$trial == focal.trial & !(t$receiver %in% pos2))] <- NA
# show progress
print(paste(i,"of",length(pos.d2)))
}
# label observed cases of food sharing
d$trial.donor.receiver <- paste0(d$trial, d$donor, d$receiver)
# get actual and possible donations
d2 <-
t %>%
# discard impossible donations
filter(duration==0) %>%
# add observed cases of food sharing
mutate(trial.donor.receiver= paste0(trial,donor,receiver)) %>%
mutate(donation.sec = d$duration[match(.$trial.donor.receiver, d$trial.donor.receiver)]) %>%
mutate(donation.sec= ifelse(is.na(donation.sec), 0, donation.sec)) %>%
# add trial duration (observation time) in seconds
mutate(observation.sec = 60*60*d$trial.duration..h.[match(.$trial, d$trial)]) %>%
# add trial dates
mutate(date = d$date[match(.$trial, d$trial)]) %>%
select(date, trial, donor, receiver, donation.sec, observation.sec)
# label kinship dyads
kinship$dyad <- paste(kinship$bat1, kinship$bat2)
# now get dyadic rates with sex, kinship
d3 <-
d2 %>%
group_by(donor, receiver) %>%
summarize(donation.sec= sum(donation.sec), possible.sec= sum(observation.sec), .groups= 'drop') %>%
# label dyad
mutate(dyad= paste(donor,receiver)) %>%
# add kinship
mutate(kinship= kinship$pedigree.m19[match(.$dyad, kinship$dyad)]) %>%
# add donor sex
mutate(donor.sex= bats$sex[match(.$donor, bats$name)]) %>%
# add receiver sex
mutate(receiver.sex= bats$sex[match(.$receiver, bats$name)]) %>%
# add donor age
mutate(donor.age.2014.10.07= bats$age20141007[match(.$donor, bats$name)]) %>%
# add receiver age
mutate(receiver.age.2014.10.07= bats$age20141007[match(.$receiver, bats$name)]) %>%
# donation rate
mutate(donation.rate= donation.sec/possible.sec) %>%
select(-dyad)
View(d3)
# clear workspace
rm(list=ls())
# load packages
library(tidyverse)
# set working directory
setwd("/Users/jkvrtilek/Desktop/OSU/PhD/GitHub/call-convergence/social_data/2016-2017_relationship_formation")
# get data
load("new_bonds_data.RData")
unique(rates$date)
unique(rates$days.together)
# get relevant data
d <-
rates %>%
as_tibble() %>%
# exclude controlled introductions?
# filter(cage.type=="colony") %>%
filter(behav== "f"| behav== "g") %>%
filter(!nonfocal) %>%
# clarify column meanings
select(datetime, period, trial, trial.duration, subject, actor, receiver, behav, duration.sec= rate, actor.origin= a.pop, receiver.origin= r.pop, actor.is.mom, receiver.is.mom, new.dyad, both.adult= adult.dyad, intro.date, days.together, actor.birthdate= a.birth, receiver.birthdate= r.birth, kinship= kinship2)
View(d)
View(d)
# save daily rates
write.csv(d, "vamp_daily_rates_2016-2017.csv")
# get dyadic grooming
g <-
d %>%
filter(behav=="g") %>%
group_by(actor, receiver) %>%
summarize(grooming.sec= sum(duration.sec, na.rm=T), observation.hours= sum(trial.duration)) %>%
ungroup()
View(g)
View(d)
View(g)
# get dyadic grooming
g <-
d %>%
filter(behav=="g") %>%
group_by(actor, receiver) %>%
summarize(grooming.sec= sum(duration.sec, na.rm=T), observation.hours= sum(trial.duration)) %>%
ungroup() %>%
mutate(observation.seconds = observation.hours*60*60) %>%
mutate(grooming.rate = grooming.sec/observation.seconds)
View(g)
write.csv(g, "vamp_dyadic_grooming_rates_2016-2017.csv")
f <-
d %>%
filter(behav=="f") %>%
group_by(actor, receiver) %>%
summarize(sharing.sec= sum(duration.sec, na.rm=T), observation.hours= sum(trial.duration)) %>%
ungroup()
View(f)
# get dyadic food-sharing
f <-
d %>%
filter(behav=="f") %>%
group_by(actor, receiver) %>%
summarize(sharing.sec= sum(duration.sec, na.rm=T), observation.hours= sum(trial.duration)) %>%
ungroup() %>%
mutate(observation.seconds = observation.hours*60*60) %>%
mutate(donation.rate = sharing.sec/observation.seconds)
View(f)
write.csv(f, "vamp_dyadic_foodsharing_rates_2016-2017.csv")
# compile all vampire bat food sharing data from Gerry Carter's postdoc
# download PhD data from here:
# Carter, Gerald (2019). Data and R Code for Carter et al. 2020. Development of new food-sharing relationships in vampire bats. Current Biology.. figshare. Dataset. https://doi.org/10.6084/m9.figshare.11369268.v1
# edited by Julia, 8 May 2024
# clear workspace
rm(list=ls())
# load packages
library(tidyverse)
# set working directory
setwd("/Users/jkvrtilek/Desktop/OSU/PhD/GitHub/call-convergence/social_data/2016-2017_relationship_formation")
# get data
load("new_bonds_data.RData")
unique(rates$date)
unique(rates$days.together)
# get relevant data
d <-
rates %>%
as_tibble() %>%
# exclude controlled introductions?
# filter(cage.type=="colony") %>%
filter(behav== "f"| behav== "g") %>%
filter(!nonfocal) %>%
# clarify column meanings
select(datetime, period, trial, trial.duration, subject, actor, receiver, behav, duration.sec= rate, actor.origin= a.pop, receiver.origin= r.pop, actor.is.mom, receiver.is.mom, new.dyad, both.adult= adult.dyad, intro.date, days.together, actor.birthdate= a.birth, receiver.birthdate= r.birth, kinship= kinship2)
# save daily rates
write.csv(d, "vamp_daily_rates_2016-2017.csv")
# get dyadic grooming
g <-
d %>%
filter(behav=="g") %>%
group_by(actor, receiver) %>%
summarize(grooming.sec= sum(duration.sec, na.rm=T), observation.hours= sum(trial.duration)) %>%
ungroup() %>%
mutate(observation.seconds = observation.hours*60*60) %>%
mutate(grooming.rate = grooming.sec/observation.seconds)
write.csv(g, "vamp_dyadic_grooming_rates_2016-2017.csv")
# get dyadic food-sharing
f <-
d %>%
filter(behav=="f") %>%
group_by(actor, receiver) %>%
summarize(sharing.sec= sum(duration.sec, na.rm=T), observation.hours= sum(trial.duration)) %>%
ungroup() %>%
mutate(observation.seconds = observation.hours*60*60) %>%
mutate(donation.rate = sharing.sec/observation.seconds)
write.csv(f, "vamp_dyadic_foodsharing_rates_2016-2017.csv")
