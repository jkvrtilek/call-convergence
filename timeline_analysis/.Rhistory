colnames(raw) <- c("sel","duration","start","end","peak_freq",
#"peak_amp",
"WAV")
View(raw)
#file1 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo/files.csv")
file1 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair/files.csv")
file2 <- file1$x
View(file1)
#file3 <- file2[stri_length(file2)==29]
file3 <- file2[stri_length(file2)==34]
file3
View(file1)
#file3 <- file2[stri_length(file2)==29]
file3 <- file2[stri_length(file2)==32]
file4 <- as.data.frame(file3)
filenames <- file4 %>%
separate(file3, into = c("bat.date","WAV"), sep = "/")
d <- raw %>%
left_join(filenames, by = "WAV") %>%
select(bat.date, WAV, sel:peak_amp)
d <- raw %>%
left_join(filenames, by = "WAV") %>%
select(bat.date, WAV, sel:peak_freq)
d2 <- d %>%
group_by(bat.date) %>%
summarize(n = n()) %>%
filter(!is.na(bat.date))
View(d2)
library(tidyverse)
library(stringi)
#raw <- read.table("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo/10ms_threshold.txt")
raw <- read.table("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair/7ms_uptojun5.txt")
View(raw)
colnames(raw) <- c("sel","duration","start","end","peak_freq","WAV")
#file1 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo/files.csv")
file1 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair/files_uptoJun5.csv")
View(file1)
file2 <- file1$x
View(file1)
#file3 <- file2[stri_length(file2)==29]
file3 <- file2
file4 <- as.data.frame(file3)
filenames <- file4 %>%
separate(file3, into = c("bat.date","WAV"), sep = "/")
View(filenames)
d <- raw %>%
left_join(filenames, by = "WAV") %>%
select(bat.date, WAV, sel:peak_freq)
d2 <- d %>%
group_by(bat.date) %>%
summarize(n = n()) %>%
filter(!is.na(bat.date))
View(d2)
View(d)
View(file4)
View(file1)
library(tidyverse)
library(stringi)
#raw <- read.table("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo/10ms_threshold.txt")
raw <- read.table("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair/7ms_uptojun5.txt")
colnames(raw) <- c("sel","duration","start","end","peak_freq","WAV")
#file1 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo/files.csv")
file1 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair/files_uptoJun5_WAV.csv") %>%
select(x)
file2 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair/files_Jun5_wav.csv") %>%
select(x)
View(file2)
#file3 <- file1[stri_length(file2)==29]
file3 <- rbind(file1,file2)
filenames <- file3 %>%
separate(x, into = c("bat.date","WAV"), sep = "/")
View(filenames)
View(file3)
d <- raw %>%
left_join(filenames, by = "WAV") %>%
select(bat.date, WAV, sel:peak_freq)
d2 <- d %>%
group_by(bat.date) %>%
summarize(n = n()) %>%
filter(!is.na(bat.date))
View(d2)
library(tidyverse)
library(stringi)
raw <- read.table("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_21h/7ms.txt")
#raw <- read.table("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair/7ms_uptojun5.txt")
colnames(raw) <- c("sel","duration","start","end","peak_freq","WAV")
file1 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo/files.csv")
file1 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_21h/files.csv")
file3 <- file1
filenames <- file3 %>%
separate(x, into = c("bat.date","WAV"), sep = "/")
View(file3)
View(file1)
nchar(file1$x[4])
file3 <- file1[stri_length(file1)==26]
file3 <- file1[stri_length(file1$x)==26]
View(file1)
file3$x <- file1[stri_length(file1$x)==26]
file3 <- file1$x[stri_length(file1$x)==26]
filenames <- file3 %>%
separate(x, into = c("bat.date","WAV"), sep = "/")
file3 <- as.data.frame(file1$x[stri_length(file1$x)==26])
View(file3)
file3 <- as.data.frame(file1$x[stri_length(file1$x)==29])
View(file3)
filenames <- file3 %>%
separate(x, into = c("bat.date","WAV"), sep = "/")
View(file3)
colnames(file3) <- "x"
filenames <- file3 %>%
separate(x, into = c("bat.date","WAV"), sep = "/")
View(filenames)
d <- raw %>%
left_join(filenames, by = "WAV") %>%
select(bat.date, WAV, sel:peak_freq)
View(d)
d2 <- d %>%
group_by(bat.date) %>%
summarize(n = n()) %>%
filter(!is.na(bat.date))
View(d2)
library(tidyverse)
library(stringi)
#raw <- read.table("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_21h/7ms.txt")
raw <- read.table("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair/7ms_uptojun5.txt")
library(tidyverse)
library(stringi)
#raw <- read.table("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_21h/7ms.txt")
raw <- read.table("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair_testing/7ms_uptojun5.txt")
colnames(raw) <- c("sel","duration","start","end","peak_freq","WAV")
#file1 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_21h/files.csv")
file1 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair_testing/files_uptoJun5_WAV.csv") %>%
select(x)
file2 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair_testing/files_Jun5_wav.csv") %>%
select(x)
# file3 <- as.data.frame(file1$x[stri_length(file1$x)==29])
# colnames(file3) <- "x"
file3 <- rbind(file1,file2)
filenames <- file3 %>%
separate(x, into = c("bat.date","WAV"), sep = "/")
d <- raw %>%
left_join(filenames, by = "WAV") %>%
select(bat.date, WAV, sel:peak_freq)
d2 <- d %>%
group_by(bat.date) %>%
summarize(n = n()) %>%
filter(!is.na(bat.date))
View(d)
View(d2)
library(tidyverse)
library(stringi)
#raw <- read.table("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_21h/7ms.txt")
raw <- read.table("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair_testing/7ms_uptojun5.txt")
colnames(raw) <- c("sel","duration","start","end","peak_freq","WAV")
#file1 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_21h/files.csv")
file1 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair_testing/files_uptoJun5_WAV.csv") %>%
select(x)
file2 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair_testing/files_Jun5_wav.csv") %>%
select(x)
# file3 <- as.data.frame(file1$x[stri_length(file1$x)==29])
# colnames(file3) <- "x"
file3 <- rbind(file1,file2)
filenames <- file3 %>%
separate(x, into = c("bat.date","WAV"), sep = "/")
d <- raw %>%
left_join(filenames, by = "WAV") %>%
select(bat.date, WAV, sel:peak_freq)
d2 <- d %>%
group_by(bat.date) %>%
summarize(n = n()) %>%
filter(!is.na(bat.date))
View(d2)
write.csv(d2, "/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair_testing.csv")
library(tidyverse)
library(stringi)
raw <- read.table("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_21h/7ms.txt")
# raw <- read.table("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair_testing/7ms_uptojun5.txt")
colnames(raw) <- c("sel","duration","start","end","peak_freq","WAV")
file1 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_21h/files.csv")
# file1 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair_testing/files_uptoJun5_WAV.csv") %>%
#   select(x)
#
# file2 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair_testing/files_Jun5_wav.csv") %>%
#   select(x)
file3 <- as.data.frame(file1$x[stri_length(file1$x)==29])
colnames(file3) <- "x"
#file3 <- rbind(file1,file2)
filenames <- file3 %>%
separate(x, into = c("bat.date","WAV"), sep = "/")
d <- raw %>%
left_join(filenames, by = "WAV") %>%
select(bat.date, WAV, sel:peak_freq)
d2 <- d %>%
group_by(bat.date) %>%
summarize(n = n()) %>%
filter(!is.na(bat.date))
View(d2)
write.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_first_round.txt")
write.csv(d2,"/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_first_round.txt")
library(tidyverse)
sraw <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_first_round.csv")
sraw <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_first_round.txt")
praw <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair_testing.csv")
View(praw)
View(praw)
View(praw)
View(sraw)
solo <- sraw %>%
select(bat.date,n) %>%
separate(bat.date, into = c("bat","month","day","year"))
pair <- praw %>%
select(bat.date,n) %>%
separate(bat.date, into = c("pair","bat","date"), sep = "_")
View(solo)
solo <- sraw %>%
separate(bat.date, into = c("bat","month","day","year")) %>%
select(bat, n)
pair <- praw %>%
separate(bat.date, into = c("pair","bat","date"), sep = "_") %>%
select(bat, n)
cor.test(solo,pair)
View(pair)
library(tidyverse)
praw <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair_testing.csv")
sraw <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_first_round.txt")
pair <- praw %>%
separate(bat.date, into = c("pair","bat","date"), sep = "_") %>%
select(bat, n)
solo <- sraw %>%
separate(bat.date, into = c("bat","month","day","year")) %>%
select(bat, n) %>%
filter(bat %in% pair$bat)
View(pair)
View(solo)
library(tidyverse)
praw <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/pair_testing.csv")
sraw <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/Recordings/solo_first_round.txt")
p2 <- praw %>%
separate(bat.date, into = c("pair","bat","date"), sep = "_") %>%
select(bat, n)
solo <- sraw %>%
separate(bat.date, into = c("bat","month","day","year")) %>%
select(bat, n) %>%
filter(bat %in% p2$bat)
pair <- p2 %>%
filter(bat %in% solo$bat)
d <- left_join(pair, solo, by = bat)
d <- left_join(pair, solo, by = "bat")
View(d)
View(d)
cor.test(d$n.x,d$n.y)
library(tidyverse)
raw <- read.csv("/Users/jkvrtilek/Desktop/Snails/CURRENT/tubeexp2data_movementscore.csv")
View(raw)
View(raw)
ggplot(data = raw, mapping = aes(x = mic, y = movement)) +
geom_bar()
View(raw)
ggplot(data = raw, mapping = aes(x = mic, y = Movement.)) +
geom_bar()
ggplot(data = raw, mapping = aes(y = Movement.)) +
geom_bar()
ggplot(data = raw, mapping = aes(y = Movement.)) +
geom_bar(col = mic)
View(raw)
ggplot(data = raw, mapping = aes(y = Movement.)) +
geom_bar(color = "mic")
ggplot(data = raw, mapping = aes(y = Movement., color = mic)) +
geom_bar()
ggplot(data = raw, mapping = aes(y = Movement., group = mic, color = mic)) +
geom_bar()
d <- raw %>%
mic <- as.factor(mic)
d <- raw %>%
mic <- as.factor("mic")
View(raw)
d <- raw %>%
mutate(mic = as.factor(mic))
ggplot(data = raw, mapping = aes(y = Movement., group = mic, color = mic)) +
geom_bar()
ggplot(data = raw, mapping = aes(y = Movement., group = mic, color = mic)) +
geom_bar() +
scale_color_grey()
ggplot(data = raw, mapping = aes(y = Movement., group = mic, color = mic)) +
geom_bar()
d <- raw %>%
mutate(mic = as.factor(mic)) %>%
mutate(Movement. = as.factor(Movement.))
str(d)
ggplot(data = raw, mapping = aes(y = Movement., group = mic, color = mic)) +
geom_bar()
ggplot(data = raw, mapping = aes(y = Movement., group = mic, color = mic)) +
geom_bar()
# linear discriminant function analysis to classify calls: bat vs group
# Julia Vrtilek
# 12 Nov 2023
# load packages
library(tidyverse)
library(MASS)
library(graph4lg)
library(vegan)
library(boot)
# set file paths and wd
setwd("/Users/jkvrtilek/Desktop/OSU/PhD/GitHub/call-convergence/timeline_analysis")
# create functions
# get mean and 95% CI of values x via bootstrapping
boot_ci <- function(x, perms=5000, bca=F) {
get_mean <- function(x, d) {
return(mean(x[d]))
}
x <- as.vector(na.omit(x))
mean <- mean(x)
if(bca){
boot <- boot.ci(boot(data=x,
statistic=get_mean,
R=perms,
parallel = "multicore",
ncpus = 4),
type="bca")
low <- boot$bca[1,4]
high <- boot$bca[1,5]
}else{
boot <- boot.ci(boot(data=x,
statistic=get_mean,
R=perms,
parallel = "multicore",
ncpus = 4),
type="perc")
low <- boot$perc[1,4]
high <- boot$perc[1,5]
}
c(low=low,mean=mean,high=high, N=round(length(x)))
}
# function to get mean and 95% CI via bootstrapping of values y within grouping variable x
boot_ci2 <- function(d=d, y=d$y, x=d$x, perms=5000, bca=F){
df <- data.frame(effect=unique(x))
df$low <- NA
df$mean <- NA
df$high <- NA
df$n.obs <- NA
for (i in 1:nrow(df)) {
ys <- y[which(x==df$effect[i])]
if (length(ys)>1 & var(ys)>0 ){
b <- boot_ci(y[which(x==df$effect[i])], perms=perms, bca=bca)
df$low[i] <- b[1]
df$mean[i] <- b[2]
df$high[i] <- b[3]
df$n.obs[i] <- b[4]
}else{
df$low[i] <- min(ys)
df$mean[i] <- mean(ys)
df$high[i] <- max(ys)
df$n.obs[i] <- length(ys)
}
}
df
}
#### select relevant bats
# read in data
raw <- read_csv("metadata.csv")
# determine which bats we're using
# get tole and las pavas bats from 2016/2017
d <- raw %>%
distinct() %>%
filter(capture.site == "las.pavas" | capture.site == "tole") %>%
separate(date, into = c("year", "month", "day"), sep = "-", remove = FALSE) %>%
mutate(date = as.Date(date)) %>%
mutate(year = as.integer(year)) %>%
filter(year < 2018)
# get call numbers for each bat
sample <- read.csv("sample_size.csv")
# NOTE: chose to remove all bats with less than 100 calls!
las.pavas <- d %>%
filter(capture.site == "las.pavas") %>%
subset(bat_ID %in% sample$bat)
tole <- d %>%
filter(capture.site == "tole") %>%
subset(bat_ID %in% sample$bat)
# divide into groups by time
# add column of group names
d2 <- rbind(las.pavas,tole) %>%
mutate(
group = case_when(capture.site == "las.pavas" ~ "lp",
capture.site == "tole" & date < "2016-08-01" ~ "tole1",
capture.site == "tole" & date > "2016-08-01" ~ "tole2")
) %>%
mutate(date.bat = paste(date,bat_ID,sep = "_"))
#### load and tidy spectral and temporal measurements
raw2 <- read.csv("/Users/jkvrtilek/Desktop/OSU/PhD/GitHub/LFS/vampire_call_measures_filtered_transformed.csv")
# select only relevant rows of specan
specan <- raw2 %>%
separate(sound.files, into = c("ds","date", "bat", "WAV", "sel"), sep = "_", remove = TRUE) %>%
dplyr::select(date:bat,duration:segments) %>%
mutate(date.bat = paste(date,bat,sep = "_")) %>%
subset(date.bat %in% d2$date.bat)
# select only relevant columns of bat metadata
temp <- d2 %>%
dplyr::select(group, date.bat)
# add group ID to measurements
specan2 <- left_join(specan, temp, by = "date.bat")
# rearrange columns into required order
specan2 <- specan2 %>%
mutate(individual = bat) %>%
dplyr::select(group, individual, 3:(ncol(specan2)-2))
#### make dataframe for each group
# tole pre-intro bats
tole_pre <- specan2 %>%
filter(group == "tole1")
# tole post-intro bats
tole_post <- specan2 %>%
filter(group == "tole2")
# las pavas bats
lp <- specan2 %>%
filter(group == "lp")
#### get all PRE-INTRO dyadic distances
pre <- rbind(tole_pre,lp)
# classify calls to bat using a single dfa without cross validation
dfa_pre <- lda(individual ~
duration+
meanfreq+
sd+
freq.median+
freq.Q25+
freq.Q75+
freq.IQR+
time.median+
time.Q25+
time.Q75+
time.IQR+
skew+
kurt+
sp.ent+
time.ent+
entropy+
sfm+
meandom+
mindom+
maxdom+
dfrange+
modindx+
startdom+
enddom+
dfslope+
meanpeakf+
peakf+
maxslope+
minslope+
abs_minslope+
pos_slopes+
neg_slopes+
turns+
meanslope+
segments,
CV= F,
data=pre)
# get vocal distance as Mahalanobis distance between group centroids
pre_distance <- as.matrix(dist(dfa_pre$means %*% dfa_pre$scaling))
# save all DFA loadings sorted by absolute value of DF1
loadings <-
dfa_pre$scaling %>%
as.data.frame() %>%
arrange(desc(abs(LD1)))
write.csv(loadings, "pre_dfa-loadings.csv")
#### get all POST-INTRO dyadic distances
post <- rbind(tole_post,lp)
# classify calls to bat using a single dfa without cross validation
dfa_post <- lda(individual ~
duration+
meanfreq+
sd+
freq.median+
freq.Q25+
freq.Q75+
freq.IQR+
time.median+
time.Q25+
time.Q75+
time.IQR+
skew+
kurt+
sp.ent+
time.ent+
entropy+
sfm+
meandom+
mindom+
maxdom+
dfrange+
modindx+
startdom+
enddom+
dfslope+
meanpeakf+
peakf+
maxslope+
minslope+
abs_minslope+
pos_slopes+
neg_slopes+
turns+
meanslope+
segments,
CV= F,
data=post)
# get vocal distance as Mahalanobis distance between group centroids
post_distance <- as.matrix(dist(dfa_post$means %*% dfa_post$scaling))
# save all DFA loadings sorted by absolute value of DF1
loadings <-
dfa_post$scaling %>%
as.data.frame() %>%
arrange(desc(abs(LD1)))
write.csv(loadings, "post_dfa-loadings.csv")
